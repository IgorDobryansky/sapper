(()=>{"use strict";function t(t,e){const a=document.createElement(t);return a.className=e,a}function e(t){return Math.floor(Math.random()*t)}function a(t,e,a,n){let r=0;return n.forEach((a=>{(+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine"))&&r++})),a[t][e].innerHTML="",0===r?a[t][e].style.backgroundColor="cadetblue":(a[t][e].style.backgroundColor="pink",a[t][e].innerHTML=r),r}function n(t,e,r,o){e<0||a(t,e,r,o)>0||(n(t,e-1,r,o),i(t-1,e,r,o),u(t+1,e,r,o))}function r(t,e,n,o){e!==n[0].length&&(a(t,e,n,o)>0||(r(t,e+1,n,o),i(t-1,e,n,o),u(t+1,e,n,o)))}function i(t,e,u,o){if(t<0)return;const l=a(...arguments);l>0||(i(t-1,e,u,o),n(t,e-1,u,o),r(t,e+1,u,o))}function u(t,e,i,o){if(t===i.length)return;const l=a(...arguments);l>0||(u(t+1,e,i,o),n(t,e-1,i,o),r(t,e+1,i,o))}const o=document.getElementById("app"),l=document.querySelector(".columns"),d=document.querySelector(".rows"),c=document.querySelector(".start"),g=document.querySelector(".reset"),s=document.querySelector(".flags"),m=document.querySelector(".mines"),b=t("div","mine-field");let f,A,v;function p(c,g){v=[],f=0,A=0;let y=0,h=!0,E=0;if(b.innerHTML="",l.value<=7||d.value<=7)return void alert("Размеры поля слишком маленькие.");if(l.value>16||d.value>16)return void alert("Размеры поля слишком большие.");b.style.gridTemplateColumns=`repeat(${l.value}, 1fr)`;for(let e=0;e<g;e++){v[e]=[];for(let a=0;a<c;a++){const n=t("div","cell");n.setAttribute("data-mine","0"),n.setAttribute("data-flag","0"),n.setAttribute("data-row",`${e}`),n.setAttribute("data-column",`${a}`),b.append(n),y++,v[e].push(n)}}for(let t=0;t<Math.round(d.value*l.value/6);t++)v[e(v.length)][e(v[0].length)].dataset.mine="1";v.forEach((t=>{t.forEach((t=>{"1"===t.getAttribute("data-mine")&&A++}))}));const k=document.querySelectorAll(".cell");v.forEach(((e,c)=>{e.forEach(((e,g)=>{e.addEventListener("click",(()=>{if("1"===e.getAttribute("data-mine")&&h)p(l.value,d.value);else if("1"!==e.getAttribute("data-mine")||h){if("0"===e.getAttribute("data-mine"))h=!1,E++,function(t,e,o,l){const d=a(...arguments);if(d>0)return d;n(t,e-1,o,l),r(t,e+1,o,l),i(t-1,e,o,l),u(t+1,e,o,l)}(c,g,v,k);else if(E===y-A){const e=t("div","win"),a=t("video","win-video"),n=t("button","again-button");a.src="@files/videoplayback.mp4",a.setAttribute("autoplay","true"),a.setAttribute("loop","true"),n.innerText="Закрыть и начать заного",e.append(a,n),n.addEventListener("click",(()=>{document.location.reload()})),o.append(e)}}else v.forEach((t=>{t.forEach((t=>{"1"===t.getAttribute("data-mine")&&(t.innerHTML="&#x1F4A3",t.style.backgroundColor="red")}))}))})),e.addEventListener("contextmenu",(t=>{t.preventDefault(),"red"!==e.style.backgroundColor&&"pink"!==e.style.backgroundColor&&("0"===e.dataset.flag?(e.dataset.flag="1",e.innerHTML="",e.innerHTML="&#128681",f++,s.innerText=`Количество установленных флагов: ${f}`):"1"===e.dataset.flag&&(e.dataset.flag="0",e.innerHTML="",f--,s.innerText=`Количество установленных флагов: ${f}`))}))}))})),m.innerText=`Количество мин: ${A}`}o.append(b),g.addEventListener("click",(()=>{f=0,A=0})),c.addEventListener("click",(t=>{t.preventDefault(),f=0,A=0,p(l.value,d.value)}))})();