(()=>{"use strict";function t(t,e){const a=document.createElement(t);return a.className=e,a}function e(t){return Math.floor(Math.random()*t)}const a=document.getElementById("app"),r=document.querySelector(".columns"),n=document.querySelector(".rows"),i=document.querySelector(".start"),u=document.querySelector(".reset"),o=document.querySelector(".flags"),d=document.querySelector(".mines"),l=t("div","mine-field");let c;a.append(l);let g=0;const m=[];function b(i,u){if(c=0,r.value<=7||n.value<=7)return void alert("Размеры поля слишком маленькие.");l.innerHTML="",g=0,l.style.gridTemplateColumns=`repeat(${r.value}, 1fr)`;let s=0;for(let e=0;e<u;e++){m[e]=[];for(let a=0;a<i;a++){const r=t("div","cell");r.setAttribute("data-mine","0"),r.setAttribute("data-flag","0"),r.setAttribute("data-row",`${e}`),r.setAttribute("data-column",`${a}`),l.append(r),s++,m[e].push(r)}}for(let t=0;t<Math.round(n.value*r.value/6);t++)m[e(m.length)][e(m[0].length)].dataset.mine="1";m.forEach((t=>{t.forEach((t=>{"1"===t.getAttribute("data-mine")&&g++}))}));const A=document.querySelectorAll(".cell");let f=!0,v=0;m.forEach(((e,i)=>{e.forEach(((e,u)=>{e.addEventListener("click",(()=>{if("1"===e.getAttribute("data-mine")&&f&&b(r.value,n.value),"1"!==e.getAttribute("data-mine")||f||m.forEach((t=>{t.forEach((t=>{"1"===t.getAttribute("data-mine")&&(t.innerHTML="&#x1F4A3",t.style.backgroundColor="red")}))})),"0"===e.getAttribute("data-mine")&&(f=!1,e.style.backgroundColor="pink",v++,console.log(v),function(t,e,a,r){let n=0;r.forEach((a=>{(+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t-1&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e-1&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e&&1==+a.getAttribute("data-mine")||+a.getAttribute("data-row")==+t+1&&+a.getAttribute("data-column")==+e+1&&1==+a.getAttribute("data-mine"))&&n++})),a.innerHTML="",a.innerHTML=n}(i,u,e,A)),v===s-g){const e=t("div","win"),r=t("video","win-video"),n=t("button","again-button");r.src="files/videoplayback.mp4",r.setAttribute("autoplay","true"),r.setAttribute("loop","true"),n.innerText="Закрыть и начать заного",e.append(r,n),n.addEventListener("click",(()=>{document.location.reload()})),a.append(e)}})),e.addEventListener("contextmenu",(t=>{t.preventDefault(),"red"!==e.style.backgroundColor&&"pink"!==e.style.backgroundColor&&("0"===e.dataset.flag?(e.dataset.flag="1",e.innerHTML="",e.innerHTML="&#128681",c++,o.innerText=`Количество установленных флагов: ${c}`):"1"===e.dataset.flag&&(e.dataset.flag="0",e.innerHTML="",c--,o.innerText=`Количество установленных флагов: ${c}`))}))}))})),d.innerText=`Количество мин: ${g}`}u.addEventListener("click",(()=>{c=0,g=0})),i.addEventListener("click",(t=>{t.preventDefault(),c=0,g=0,b(r.value,n.value)}))})();