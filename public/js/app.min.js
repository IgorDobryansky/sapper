(()=>{"use strict";function e(e,t){const n=document.createElement(e);return n.className=t,n}function t(e){return Math.floor(Math.random()*e)}function n(e,t,n){let a=0;return n.includes(n[e])&&n[e].includes(n[e][t-1])&&1==+n[e][t-1].getAttribute("data-mine")&&a++,n.includes(n[e-1])&&n[e-1].includes(n[e-1][t-1])&&1==+n[e-1][t-1].getAttribute("data-mine")&&a++,n.includes(n[e-1])&&n[e-1].includes(n[e-1][t])&&1==+n[e-1][t].getAttribute("data-mine")&&a++,n.includes(n[e-1])&&n[e-1].includes(n[e-1][t+1])&&1==+n[e-1][t+1].getAttribute("data-mine")&&a++,n.includes(n[e])&&n[e].includes(n[e][t+1])&&1==+n[e][t+1].getAttribute("data-mine")&&a++,n.includes(n[e+1])&&n[e+1].includes(n[e+1][t-1])&&1==+n[e+1][t-1].getAttribute("data-mine")&&a++,n.includes(n[e+1])&&n[e+1].includes(n[e+1][t])&&1==+n[e+1][t].getAttribute("data-mine")&&a++,n.includes(n[e+1])&&n[e+1].includes(n[e+1][t+1])&&1==+n[e+1][t+1].getAttribute("data-mine")&&a++,n[e][t].innerHTML="",0===a?n[e][t].style.opacity=0:(n[e][t].style.backgroundColor="pink",n[e][t].innerHTML=a),a}function a(e,t,a){n(e,t,a)>0||(i(e,t-1,a),r(e,t+1,a),u(e-1,t,a),l(e+1,t,a))}function i(e,t,a){t<0||1!=+a[e][t].getAttribute("data-mine")&&(n(e,t,a)>0||i(e,t-1,a))}function r(e,t,a){t!==a[0].length&&1!=+a[e][t].getAttribute("data-mine")&&(n(e,t,a)>0||r(e,t+1,a))}function u(e,t,a){e<0||1!=+a[e][t].getAttribute("data-mine")&&(n(e,t,a)>0||u(e-1,t,a))}function l(e,t,a){e!==a.length&&1!=+a[e][t].getAttribute("data-mine")&&(n(e,t,a)>0||l(e+1,t,a))}const d=document.getElementById("app"),c=document.querySelector(".columns"),o=document.querySelector(".rows"),s=document.querySelector(".start"),m=document.querySelector(".reset"),f=document.querySelector(".flags"),g=document.querySelector(".mines"),b=e("div","mine-field");let A,v,p;function y(n,i){p=[],A=0,v=0;let r=0,u=!0,l=0;if(b.innerHTML="",c.value<=7||o.value<=7)alert("Размеры поля слишком маленькие.");else if(c.value>16||o.value>16)alert("Размеры поля слишком большие.");else{b.style.gridTemplateColumns=`repeat(${c.value}, 1fr)`;for(let t=0;t<i;t++){p[t]=[];for(let a=0;a<n;a++){const n=e("div","cell");n.setAttribute("data-mine","0"),n.setAttribute("data-flag","0"),n.setAttribute("data-row",`${t}`),n.setAttribute("data-column",`${a}`),b.append(n),r++,p[t].push(n)}}for(let e=0;e<Math.round(o.value*c.value/6);e++)p[t(p.length)][t(p[0].length)].dataset.mine="1";p.forEach((e=>{e.forEach((e=>{"1"===e.getAttribute("data-mine")&&v++}))})),document.querySelectorAll(".cell"),p.forEach(((t,n)=>{t.forEach(((t,i)=>{t.addEventListener("click",(()=>{if("1"===t.getAttribute("data-mine")&&u)y(c.value,o.value);else if("1"!==t.getAttribute("data-mine")||u){if("0"===t.getAttribute("data-mine"))u=!1,l++,a(n,i,p);else if(l===r-v){const t=e("div","win"),n=e("video","win-video"),a=e("button","again-button");n.src="@files/videoplayback.mp4",n.setAttribute("autoplay","true"),n.setAttribute("loop","true"),a.innerText="Закрыть и начать заного",t.append(n,a),a.addEventListener("click",(()=>{document.location.reload()})),d.append(t)}}else p.forEach((e=>{e.forEach((e=>{"1"===e.getAttribute("data-mine")&&(e.innerHTML="&#x1F4A3",e.style.backgroundColor="red")}))}))})),t.addEventListener("contextmenu",(e=>{e.preventDefault(),"red"!==t.style.backgroundColor&&"pink"!==t.style.backgroundColor&&("0"===t.dataset.flag?(t.dataset.flag="1",t.innerHTML="",t.innerHTML="&#128681",A++,f.innerText=`Количество установленных флагов: ${A}`):"1"===t.dataset.flag&&(t.dataset.flag="0",t.innerHTML="",A--,f.innerText=`Количество установленных флагов: ${A}`))}))}))})),g.innerText=`Количество мин: ${v}`}}d.append(b),m.addEventListener("click",(()=>{A=0,v=0})),s.addEventListener("click",(e=>{e.preventDefault(),A=0,v=0,y(c.value,o.value)}))})();