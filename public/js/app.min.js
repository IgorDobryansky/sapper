(()=>{"use strict";const e="&#128681",t=document.getElementById("app"),n=document.querySelector(".columns"),r=document.querySelector(".rows"),a=document.querySelector(".start"),i=document.querySelector(".reset"),o=document.querySelector(".flags"),c=document.querySelector(".mines"),l=function(e,t){const n=document.createElement("div");return n.className="mine-field",n}();let u,d;function s(t,n){u=0,o.innerText=`Количество установленных флагов: ${u}`;const r=Math.round(n*t/6);l.style.gridTemplateColumns=`repeat(${t}, 1fr)`;const a=n*t;l.innerHTML='\n  <div class="cell" data-flag="0" data-open="0">\n  </div>\n  '.repeat(a);const i=[...l.children],d=[...Array(a).keys()].sort((()=>Math.random()-.5)).slice(0,r);function s(e,r){return r>=0&&r<n&&e>=0&&e<t}function f(e,n){if(!s(e,n))return;const r=i[n*t+e];if(m(e,n))return void i.forEach(((e,t)=>{d.includes(t)&&(e.innerHTML="&#x1F4A3",e.setAttribute("data-open","1"),e.style.backgroundColor="red")}));const a=function(e,t){let n=0;for(let r=-1;r<=1;r++)for(let a=-1;a<=1;a++)m(e+a,t+r)&&n++;return n}(e,n);if(0!==a)return r.innerHTML=a,void r.setAttribute("data-open","1");if(1!=+r.getAttribute("data-open")){r.setAttribute("data-open","1"),r.style.opacity=0;for(let t=-1;t<=1;t++)for(let r=-1;r<=1;r++)f(e+r,n+t)}}function m(e,n){if(!s(e,n))return!1;const r=n*t+e;return d.includes(r)}c.innerHTML=`Количество мин: ${d.length}`,l.addEventListener("click",(e=>{if("cell"!==e.target.className)return;const n=i.indexOf(e.target);f(n%t,Math.floor(n/t))})),l.addEventListener("contextmenu",(t=>{t.preventDefault();const n=t.target;"cell"!==n.className||1==+n.getAttribute("data-open")||+n.innerHTML>0||(n.innerHTML=e,0==+n.getAttribute("data-flag")?(n.setAttribute("data-flag","1"),n.innerHTML="",n.innerHTML=e,u++,o.innerText=`Количество установленных флагов: ${u}`):1==+n.getAttribute("data-flag")&&(n.setAttribute("data-flag","0"),n.innerHTML="",u--,o.innerText=`Количество установленных флагов: ${u}`))}))}t.append(l),i.addEventListener("click",(()=>{u=0,d=0})),a.addEventListener("click",(e=>{e.preventDefault(),u=0,d=0,s(n.value,r.value)}))})();